<template>
    <!-- TODO: https://blog.csdn.net/qq_45453266/article/details/105680123 -->
    <div style="height:700px;">
        <div class="indexSearch">
            <div id="container" class="wordcloud-container"></div>
            <picture>
                <!-- <img alt="FOFA" src="https://static.fofa.info/_nuxt/fofa/img/logo.d9ee5c4.png" class="indexLogo"> -->
                <!-- <img src="./logo.png"> -->
                <span style="font-size:100px;color:#E6D5FF;font-family:Times New Roman;">Rouge Killer</span>
            </picture>
            <!-- TODO:加入上传文件功能 -->
            <!-- TODO:校验不能为空 -->
            <el-input placeholder="请输入待检测的网址链接" v-model="input" class="input" clearable>
                <el-button slot="append" icon="el-icon-search" @click="detectSite()" ></el-button>
            </el-input>
        </div>
        <el-dialog :visible.sync="dialogVisible" width="30%" @closed="handleClose">
            <template v-if="detectFinish==false" slot="title" >
                <span style="line-height: 24px;font-size: 18px; color: #d4dbe7;">系统正在检测中</span>
            </template>
            <template v-else  slot="title">
                <span style="line-height: 24px;font-size: 18px; color: #d4dbe7;">系统检测完成</span>
            </template>

            <div>目标网站：{{input}}</div>
            <!-- <div  v-if="detectFinish==false"  class="ml-loader" style="margin-left:170px;margin-top:10px;">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>       -->
            <div v-if="detectFinish==false" style="min-height:90px;margin-top:130px;"> 
                <div style="margin-top:30px;" class="mesh-loader">
                    <div class="set-one">
                        <div class="circle"></div>
                        <div class="circle"></div>
                    </div>
                    <div class="set-two">
                        <div class="circle"></div>
                        <div class="circle"></div>
                    </div>
                </div> 
            </div>
   
            <el-result v-if="detectFinish==true"  icon="success" title="检测完成" subTitle="">
                <template slot="subTitle">
                    该网站为恶意网站
                  </template>
                <template slot="extra">
                  <el-button type="primary" size="medium" @click="getResult()">查看报告</el-button>
                </template>
            </el-result>      
            
            <span slot="footer" class="dialog-footer">
                <el-button v-if="detectFinish==false" @click="dialogVisible = false">取 消</el-button>
                <!-- <el-button v-if="detectFinish==true" @click="getDetectResult" type="primary">查看报告</el-button> -->
            </span>
        </el-dialog>

    </div>
</template>


<script>
import { WordCloud } from '@antv/g2plot';

export default {
    data(){
        return{
            input:'',
            dialogVisible: false,
            detectFinish:false,
        }
    },

    methods:{
        isTrueUrl(value){
            let reg = /(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/
            if (!reg.test(value)) {
                this.$message({
                    message: '请输入正确的网站链接！',
                    type: 'warning'
                });
                return false;
            }
            return true;
        },
        validate(){
            var tc1 = "http://helloworld.com"
            this.isTrueUrl(tc1);
            var tc4 = "helloWorld";
            this.isTrueUrl(tc4);
        },
        detectSite(){
            const legal = this.isTrueUrl(this.input);
            if(!legal){
                return
            }
            this.dialogVisible=true;
            // Just to simulate the time of the request
            setTimeout(() => {
                this.detectFinish=true;
            }, 4 * 1000)
            
            // this.axios({ //像后端请求检测网站接口:如果在数据库中则展示数据库，如果不在则调用模型检测
            //     url:"",
            //     method:"post",
            //     param:{"url":this.input}
            // }).then(res=>{
                
            // })
        },
        handleClose(){
            this.detectFinish=false;
        },
        getDetectResult(){
            
        },
        showWordCloud(){ //展示Rouge Killer形状的词云
            
            fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/antv-keywords.json')
            .then((res) => res.json())
            .then((data) => {
                var official = "https://cn.bing.com/images/search?view=detailV2&ccid=AZ0hM5c6&id=67F867A17C598D9996CAC4EFF325D6CF38C26410&thid=OIP.AZ0hM5c6oeDj35DUrdPFoAHaDP&mediaurl=https%3a%2f%2fwww.shentoushi.top%2fPublic%2fhome%2fimages%2ficons%2ffofa.png&exph=250&expw=571&q=Fofa%e5%9b%be%e6%a0%87&simid=608050550774761745&FORM=IRPRST&ck=1AAC9BA2688F50244C90A930010F865F&selectedIndex=0&idpp=overlayview&ajaxhist=0&ajaxserp=0";
                var fofa = "https://static.fofa.info/_nuxt/fofa/img/logo.d9ee5c4.png"
                const wordCloud = new WordCloud('container', {
                data,
                wordField: 'name',
                weightField: 'value',
                colorField: 'value',
                //https://cn.bing.com/images/search?view=detailV2&ccid=AZ0hM5c6&id=67F867A17C598D9996CAC4EFF325D6CF38C26410&thid=OIP.AZ0hM5c6oeDj35DUrdPFoAHaDP&mediaurl=https%3a%2f%2fwww.shentoushi.top%2fPublic%2fhome%2fimages%2ficons%2ffofa.png&exph=250&expw=571&q=Fofa%e5%9b%be%e6%a0%87&simid=608050550774761745&FORM=IRPRST&ck=1AAC9BA2688F50244C90A930010F865F&selectedIndex=0&idpp=overlayview&ajaxhist=0&ajaxserp=0
                //'https://gw.alipayobjects.com/mdn/rms_2274c3/afts/img/A*07tdTIOmvlYAAAAAAAAAAABkARQnAQ'
                
                imageMask: fofa,
                wordStyle: {
                    fontFamily: 'Verdana',
                    fontSize: [8, 32],
                },
                });
                wordCloud.render();
            });
        },
        getResult(){
            // this.$router.push({path:"/sites/detail",query: {id:sid}})
            this.$router.push({path:"/sites/detail",query: {id:1561}})
        }
    },
    mounted(){
        // this.showWordCloud();
        // this.validate()
    }




}
</script>


<style scoped>

    .input{
        margin-top: 40px;
        
    }
    /deep/.el-dialog {
        background: #343b44;
    }

    /deep/ .el-input__inner{
        border: 1px solid #a298a2;
        height: 50px;
         background-color: #5d5c5d42 !important;
        /*border-radius: 24px;*/
    }


    /deep/ .el-input-group__append, .el-input-group__prepend{
        border: 1px solid #a298a2;
        background-color: #5d5c5d42;
    }

    /deep/.el-result__title p {
        margin: 0;
        font-size: 20px;
        color: #49b110;
        line-height: 1.3;
    }

    .indexSearch {
        left: 0;
        margin: auto;
        max-width: 922px;
        position: absolute;
        right: 0;
        top: 25vh;
        width: 48%;
        z-index: 100;
    }
    .indexSearch .indexLogo {
        display: block;
        height: 90px;
        margin: 0 auto;
        width: 238px;
    }
    /*.wordcloud-container{
        height:200px;
        width:300px
    }*/



    .ml-loader {
        position: relative;
        width: 70px;
        height: 70px;
      }
      
      .ml-loader div {
        -webkit-transform-origin: 32px 32px;
            -ms-transform-origin: 32px 32px;
                transform-origin: 32px 32px;
        -webkit-animation: 1.2s opaque ease-in-out infinite both;
                animation: 1.2s opaque ease-in-out infinite both;
      }
      
      .ml-loader div::after {
        content: "";
        display: block;
        position: absolute;
        top: 0;
        left: 30px;
        width: 5px;
        height: 18px;
        border-radius: 10px;
        background-color: #c09fd7;
      }
      
      .ml-loader div:nth-child(1) {
        -webkit-transform: rotate(0);
            -ms-transform: rotate(0);
                transform: rotate(0);
      }
      .ml-loader div:nth-child(2) {
        -webkit-transform: rotate(30deg);
            -ms-transform: rotate(30deg);
                transform: rotate(30deg);
        -webkit-animation-delay: 0.1s;
                animation-delay: 0.1s;
      }
      .ml-loader div:nth-child(3) {
        -webkit-transform: rotate(60deg);
            -ms-transform: rotate(60deg);
                transform: rotate(60deg);
        -webkit-animation-delay: 0.2s;
                animation-delay: 0.2s;
      }
      .ml-loader div:nth-child(4) {
        -webkit-transform: rotate(90deg);
            -ms-transform: rotate(90deg);
                transform: rotate(90deg);
        -webkit-animation-delay: 0.3s;
                animation-delay: 0.3s;
      }
      .ml-loader div:nth-child(5) {
        -webkit-transform: rotate(120deg);
            -ms-transform: rotate(120deg);
                transform: rotate(120deg);
        -webkit-animation-delay: 0.4s;
                animation-delay: 0.4s;
      }
      .ml-loader div:nth-child(6) {
        -webkit-transform: rotate(150deg);
            -ms-transform: rotate(150deg);
                transform: rotate(150deg);
        -webkit-animation-delay: 0.5s;
                animation-delay: 0.5s;
      }
      .ml-loader div:nth-child(7) {
        -webkit-transform: rotate(180deg);
            -ms-transform: rotate(180deg);
                transform: rotate(180deg);
        -webkit-animation-delay: 0.6s;
                animation-delay: 0.6s;
      }
      .ml-loader div:nth-child(8) {
        -webkit-transform: rotate(210deg);
            -ms-transform: rotate(210deg);
                transform: rotate(210deg);
        -webkit-animation-delay: 0.7s;
                animation-delay: 0.7s;
      }
      .ml-loader div:nth-child(9) {
        -webkit-transform: rotate(240deg);
            -ms-transform: rotate(240deg);
                transform: rotate(240deg);
        -webkit-animation-delay: 0.8s;
                animation-delay: 0.8s;
      }
      .ml-loader div:nth-child(10) {
        -webkit-transform: rotate(270deg);
            -ms-transform: rotate(270deg);
                transform: rotate(270deg);
        -webkit-animation-delay: 0.9s;
                animation-delay: 0.9s;
      }
      .ml-loader div:nth-child(11) {
        -webkit-transform: rotate(300deg);
            -ms-transform: rotate(300deg);
                transform: rotate(300deg);
        -webkit-animation-delay: 1s;
                animation-delay: 1s;
      }
      .ml-loader div:nth-child(12) {
        -webkit-transform: rotate(330deg);
            -ms-transform: rotate(330deg);
                transform: rotate(330deg);
        -webkit-animation-delay: 1.1s;
                animation-delay: 1.1s;
      }
      .ml-loader div:nth-child(13) {
        -webkit-transform: rotate(360deg);
            -ms-transform: rotate(360deg);
                transform: rotate(360deg);
        -webkit-animation-delay: 1.2s;
                animation-delay: 1.2s;
      }
      
      @-webkit-keyframes opaque {
          0%, 40%, 100% {
            opacity: 0.1;
          }
          40% {
            opacity: 1;
          }
      }
      
      @keyframes opaque {
          0%, 40%, 100% {
            opacity: 0.1;
          }
          40% {
            opacity: 1;
          }
      }







      .mesh-loader {
        overflow: hidden;
        height: 100%;
        width: 100%;
    }
    
    .mesh-loader .circle {
        width: 25px;
        height: 25px;
        position: absolute;
        background: #03A9F4;
        border-radius: 50%;
        margin: -12.5px;
        -webkit-animation: mesh 3s ease-in-out infinite;
        animation: mesh 3s ease-in-out infinite -1.5s;
    }
    
    .mesh-loader > div .circle:last-child {
        -webkit-animation-delay: 0s;
        animation-delay: 0s;
    }
    
    .mesh-loader > div {
        position: absolute;
        top: 50%;
        left: 50%;
    }
    
    .mesh-loader > div:last-child {
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg);
    }
    
    @-webkit-keyframes mesh {
      0% {
        -webkit-transform-origin: 50% -100%;
                transform-origin: 50% -100%;
        -webkit-transform: rotate(0);
                transform: rotate(0);
      }
      50% {
        -webkit-transform-origin: 50% -100%;
                transform-origin: 50% -100%;
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
      }
      50.00001% {
        -webkit-transform-origin: 50% 200%;
                transform-origin: 50% 200%;
        -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
      }
      100% {
        -webkit-transform-origin: 50% 200%;
                transform-origin: 50% 200%;
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
      }
    }
    @keyframes mesh {
      0% {
        -webkit-transform-origin: 50% -100%;
                transform-origin: 50% -100%;
        -webkit-transform: rotate(0);
                transform: rotate(0);
      }
      50% {
        -webkit-transform-origin: 50% -100%;
                transform-origin: 50% -100%;
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
      }
      50.00001% {
        -webkit-transform-origin: 50% 200%;
                transform-origin: 50% 200%;
        -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
      }
      100% {
        -webkit-transform-origin: 50% 200%;
                transform-origin: 50% 200%;
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
      }
    }
    
</style>