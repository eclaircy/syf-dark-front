<template>
    <div class="page-container">
        <el-row>
            <el-card>
                 <div style="font-size: 20px;margin-bottom: 7px;">软件下载网站检索</div>
                 <!-- <span>追踪团伙构成恶意下载网站、背后公司组成、涉及人员</span> -->
                 <el-divider></el-divider>
            </el-card>
        </el-row>
        
        <div class="search-container" :style="{height: searchHeight}"> 
            <el-input placeholder="请输入内容" v-model="search.input1" class="input-with-select" clearable style="width:240px;margin-left:10px;">
                <el-select v-model="select.select1" slot="prepend" placeholder="请选择"  style="width:100px">
                    <el-option key="url" label="网址" value="url"></el-option>
                    <el-option key="siteTitle" label="网站标题" value="siteTitle"></el-option>
                    <el-option key="ip" label="IP" value="ip"></el-option>
                </el-select>
            </el-input>

            <el-input placeholder="请输入内容" suffix-icon="el-icon-office-building" clearable style="width:240px" v-model="search.input2">
                <template slot="prepend">公司</template>
            </el-input>
            <el-input placeholder="请输入内容" suffix-icon="el-icon-s-custom" clearable style="width:240px" v-model="search.input3">
                <template slot="prepend">法定代表人</template>
            </el-input>

            <el-select v-model="siteTypeValue" placeholder="请选择网站分类" style="margin-left:10px;margin-right:20px;"> 
                <el-option
                  v-for="item in siteType"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value">
                  <span style="float: left">{{ item.label }}</span>
                  <span style="float: right; color: #8492a6; font-size: 13px">{{ item.value }}</span>
                </el-option>
            </el-select>


            <el-button size="medium" type="primary" @click="Search(1)">查询   <i class="el-icon-search"></i></el-button>
            <el-button size="medium" type="primary" @click="handleClearSearch()">清空</el-button>

            <el-link v-if="showMore==false" @click="changeMenu()" icon="el-icon-d-arrow-right" style="float:right;margin-top: 10px;">展开更多条件</el-link>

            <div style="margin-top:20px;"  v-if="showMore==true" > 
                <el-input placeholder="请输入内容" v-model="search.input4" suffix-icon="el-icon-map-location" class="input-with-select" clearable style="width:240px;margin-left:60px;">
                    <el-select v-model="select.select2" slot="prepend" placeholder="请选择"  style="width:100px">
                        <el-option key="country" label="国家" value="country"></el-option>
                        <el-option key="province" label="省份" value="province"></el-option>
                        <el-option key="urban" label="市区" value="urban"></el-option>
                    </el-select>
                </el-input>
    
                <el-date-picker style="margin-left: 50px;"
                    v-model="dateValue"
                    type="daterange"
                    align="right"
                    unlink-panels
                    range-separator="至"
                    start-placeholder="开始日期"
                    end-placeholder="结束日期"
                    :picker-options="pickerOptions">
                </el-date-picker>
                
                <el-link @click="changeMenu()" icon="el-icon-d-arrow-right" style="float:right;margin-top: 15px;">收起条件</el-link>
                
            </div>
            
            
        </div>

        <el-row>
            <el-col :span="5">
                <!-- TODO:改成统计图表，不然太重复了 -->
                <div class="search-charts-container"> 
                    <MyPanelCard class="panel-card" header="相关结果" :countNumber="sitesInfoByPage.total"/>
                    <ResultRadar style="margin-top:40px"/>
                    <ResultPie  style="margin-top:50px"/>
                </div>
            </el-col>
            <el-col :span="19"> 
                    <SiteSimpleCard :sitesInfoByPage="sitesInfoByPage.records"/>
            </el-col>
        </el-row>

        <div class="pagination-container"> 
            <!-- <el-row :gutter="20">
                <el-col :span="12" :offset="6"> -->
                  <div class="pagination">
                    <el-pagination
                      @size-change="handleSizeChange"
                      @current-change="handleCurrentChange"
                      :current-page.sync="paginations.currentPage"
                      :page-size="paginations.pageSize"
                      :layout="paginations.layout"
                      :total="paginations.totalPage">
                    </el-pagination>
                  </div>
                <!-- </el-col>
            </el-row> -->
        </div>
        

  </div>
</template>

  
<script>
import MyPanelCard from './MyPanelCard.vue';
import SiteSimpleCard from './SiteSimpleCard.vue';
import ResultPie from './ResultPie.vue';
import ResultRadar from './ResultRadar.vue';


export default {
    components:{
        SiteSimpleCard,
        MyPanelCard,
        ResultPie,
        ResultRadar
    },
    data() {
        return {
            activeName: 'first',
            search:{
                input1: '',
                input2: '',
                input3: '',
                input4: '',
                
            },
            select:{
                select1:'url', //对应input1
                select2:'country', //对应input4
            },
            siteType: [
                {
                    value: 'NO LIMIT',
                    label: '类型不限'
                }, 
                {
                    value: 'ANOMOLY',
                    label: '恶意类型'
                }, 
                {
                    value: 'NORMAL',
                    label: '正常类型'
                }
            ],
            siteTypeValue:'', //默认值'不限
            pickerOptions: {
                shortcuts: [{
                    text: '最近一周',
                    onClick(picker) {
                        const end = new Date();
                        const start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                        picker.$emit('pick', [start, end]);
                    }
                }, {
                    text: '最近一个月',
                    onClick(picker) {
                        const end = new Date();
                        const start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                        picker.$emit('pick', [start, end]);
                    }
                }, {
                    text: '最近三个月',
                    onClick(picker) {
                        const end = new Date();
                        const start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                        picker.$emit('pick', [start, end]);
                    }
                }]
            },
            dateValue: '',
            showMore:false,
            sitesInfoByPage:{},
            searchHeight:"90px",
            paginations:{
                currentPage: 1,
                totalPage: '',
                pageSize: 6,
                layout:"total, prev, pager, next, jumper",
            }

        }
    },
    methods:{
        //切换选项卡tab
        handleClick(tab, event) {
            console.log(tab, event);
        },
        //分页
        handleSizeChange(val) {
            console.log(`每页 ${val} 条`);
        },
        handleCurrentChange(val) { //当前页val
            this.paginations.currentPage=val;
            this.Search(val);
            // console.log(`当前页: ${val}`);
        },
        handleClearSearch(){
            for (let key in this.search) {
                this.search[key] = ''
            }
            this.dateValue=''
            this.siteTypeValue=''
        },
        changeMenu(){
            this.showMore=!this.showMore;
            if(this.showMore==true){
                this.searchHeight="132px";
            }else{
                this.searchHeight="90px";
            }
            
        },
        Search(page){ //
            var searchParam = ''
            for (let key in this.search) {
                console.log(`key: ${key}, value: ${this.search[key]}`);
                if(key=="input1" && this.search[key]!=''){
                    searchParam = searchParam + this.select.select1 +"="+ this.search[key]
                }
                else if(key=="input2" & this.search[key]!=''){
                    searchParam = searchParam + '&' + "company" +"="+  this.search[key]
                }
                else if(key=="input3" & this.search[key]!=''){
                    searchParam = searchParam + '&' + "person" +"="+  this.search[key]
                }
                else if(key=="input4" && this.search[key]!=''){
                    searchParam = searchParam +"&" + this.select.select2 +"="+  this.search[key]
                }
            }
            console.log(searchParam)

            this.axios({
                url:"api/sites/?"+searchParam,
                method: 'get',
                params:{
                    "page":page,
                    "limit":6
                }
            }).then(res=>{
                console.log(res);
                this.sitesInfoByPage = res.data.data;
                this.paginations.currentPage = page;
                this.paginations.totalPage = res.data.data.total;
            })
        },

        //搜索结果
        getSearchResult(sitesInfoByPage){ //sitesInfoByPage从子组件里传入
            this.sitesInfoByPage=sitesInfoByPage;
            console.log(this.sitesInfoByPage)
        },
    },
    created(){
        this.Search(1);
    },
}
</script>
  
<style scoped>
    .page-container{
        padding: 24px;
    }

    .search-container{
        background: #343A40;
        padding: 10px;
        margin-bottom: 20px;
        /**height: 132px;**/
        border-radius:0px;
        overflow:hidden; 
    }

    .el-input{
        margin-right:20px;
    }
    /deep/.el-input-group__append, .el-input-group__prepend {
        background-color: #313846;
        color: #909399;
        border: 1px solid #b2b7be !important;
    }
    /deep/ .el-input__inner{
        border: 1px solid #DCDFE6;
        height: 40px;
        /*border-radius: 24px;*/
    }

    /deep/ .el-input-group__append, .el-input-group__prepend{
        border: 1px solid #DCDFE6;
    }

    /deep/.el-button--medium {
        padding: 10px 20px;
        font-size: 14px;
        border-radius: 4px;
        height: 40px;
        width: 80px;
    }

    /deep/.el-pager li {
        background: #343A40;
    }

    /deep/.el-pagination .btn-prev, .el-pagination .btn-next {
        background-color: #343A40;
    }
    /deep/.el-pagination .btn-prev{
        background-color: #343A40 !important;
    }
    /deep/.el-pagination .btn-next {
        background-color: #343A40;
    }

    .search-charts-container{
        background-color: #343A40;
        height: 747px;
        margin-right: 5px;
        padding: 10px;
    }
    .search-charts-container > * {
        margin-left: 10px;
        margin-right: 10px;
        margin-top: 20px;
      }
      
    .panel-card{
        margin-bottom: 20px;
    }
    .card-body{
        flex: 1 1 auto;
        padding: 1rem 1rem;
        background-color: white;
    }

    .pagination{
       margin-top:10px;
       margin-bottom: 10px;
       margin-left: 319.8px;
    }

    .pagination-container{
        background-color: #343A40;
        height: 52px;
       
        border-radius:0px;
        margin-top:10px;
    }
    /deep/.el-tabs__nav-scroll {
        background-color: #343a40;
    }
    /deep/.el-tabs--card > .el-tabs__header .el-tabs__nav {
        border: 1px solid #a7a7a7;
        margin-left: 20px;
        /* border-bottom: none; */
    }
    /deep/.el-tabs--card > .el-tabs__header .el-tabs__item {
        border-bottom: 1px solid transparent;
        border-left: 1px solid #a7a7a7;
    }
    /deep/.el-tabs__header {
        margin: 0px; 
    }
    /deep/.el-link.el-link--default {
        color: #99a0a3;
    }
    /deep/.el-link.el-link--default:hover {
        color: #1890ff;
    }

</style>