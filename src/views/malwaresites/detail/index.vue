<template>
    <div style="margin-top:30px;margin-left:40px;margin-right:40px;">
       
        <el-row gutter="32">
            <el-col :span="10">
                网站信息
                <!-- TODO:卡片的背景颜色background-color: #343A40; -->
                <el-card style="position:relative;margin-bottom:20px;">  
                    <h3>{{sitesInfo.domain}}</h3>
                    <li>{{sitesInfo.country}}</li>
                    <li>{{sitesInfo.country}}</li>
                    <li>{{sitesInfo.country}}</li>

                        <el-col :span="20">
                            <div class="top-info">
                                <div style="font-weight: 700;margin-right:10px;margin-bottom:10px;font-size:25px">{{sitesInfo.domain}}</div>  
                                <i class="el-icon-location"></i>
                                <span class="site-location">国家：{{sitesInfo.country}}</span>
                                <el-divider direction="vertical"></el-divider>

                                <i class="el-icon-location-outline"></i>
                                <span class="site-location">省份：{{sitesInfo.province}}</span>
                                <el-divider direction="vertical"></el-divider>

                                <i class="el-icon-location-information"></i>
                                <span class="site-location">市区：{{sitesInfo.urban}}</span>
                                
                                <el-button type="danger" plain @click="dialogFormVisible = true">添加标签</el-button>
                                <el-dialog title="" :visible.sync="dialogFormVisible">
                                    <el-form :model="form">
                                    <el-form-item label="网站类型" :label-width="formLabelWidth">
                                    <el-select v-model="form.region" placeholder="请选择标签">
                                        <el-option label="恶意网站" value="0"></el-option>
                                        <el-option label="普通网站" value="1"></el-option>
                                        <el-option label="不确定" value="2"></el-option>
                                    </el-select>
                                        </el-form-item>
                                    <el-form-item label="详细信息" :label-width="formLabelWidth">
                                    <el-input v-model="form.name" type="textarea" autocomplete="off" :rows="5" placeholder="请输入内容"   
                                        maxlength="1024" show-word-limit></el-input>
                                    </el-form-item>
                                    
                                    </el-form>
                                    <div slot="footer" class="dialog-footer">
                                        <el-button @click="dialogFormVisible = false">取 消</el-button>
                                        <el-button type="primary" @click="dialogFormVisible = false">提 交</el-button>
                                    </div>
                                </el-dialog>
                                <p></p>
                                
                                <el-divider direction="vertical"></el-divider>
                                <i class=" el-icon-user-solid"></i>
                                <span class="site-location">公司：{{sitesInfo.urban}}</span>

                                <el-divider direction="vertical"></el-divider>
                                <i class=" el-icon-user-solid"></i>
                                <span class="site-location">拥有人：{{sitesInfo.urban}}</span>

                                <p></p>

                                <el-divider direction="vertical"></el-divider>
                                <span class="site-location">IP:{{sitesInfo.ip}}</span>

                                <el-divider direction="vertical"></el-divider>
                                <span class="site-location">IP标签：{{sitesInfo.ipLabel}}</span>
                                
                                <el-divider direction="vertical"></el-divider>
                                <span class="site-location">端口号：{{sitesInfo.port}}</span>

                            </div>
                        </el-col>
                    <!-- </el-row> -->
                     <el-tag  size="medium" type="primary" plain>国家</el-tag>    
                </el-card>    
            </el-col>
            <el-col :span="14">
                公司信息
                <el-card>
                    公司信息/画像 
                    相似公司：柱状图，按照相似度高低
                    <CompanyInfo/>
                </el-card>
            </el-col>
        </el-row>

        <el-button @click="drawer = true" type="primary" style="margin-left: 16px;">
            点我打开
        </el-button>
        <el-drawer
            title="我是标题"
            style="height:50%;margin-top:60px"
            :visible.sync="drawer"
            :direction="direction"
            :before-close="handleClose">
            <span>我来啦!</span>
            
        </el-drawer>
        <h4>
            知识图谱：
            展示个数：相关ip、相关证书、相关网站、相关公司、相关持有人
            1、一个网站直接相关联的其他实体（一度信息）：公司、证书、持有人等
            2、一个网站相关联的其他网站（可以放2度？）
        </h4>

        <el-card>
            <h4>网站关联图谱</h4>
            <el-button>一度关系</el-button><el-button>二度关系</el-button><el-button>三度关系</el-button> 
            <el-row>
                <el-col :span="16">
                    <div id="container" class="graph-container"></div>
                </el-col>
                <el-col :span="8">
                    <el-card class="box-card" shadow="none">
                        <div slot="header" class="clearfix">
                          <span>卡片名称</span>
                          <el-button style="float: right; padding: 3px 0" type="text">操作按钮</el-button>
                        </div>
                        <div v-for="o in 4" :key="o" class="text item">
                          {{'列表内容 ' + o }}
                        </div>
                      </el-card>
                </el-col>
            </el-row>
            
        </el-card>
        <div class="graph-analyse">
            <el-row gutter=32>
                <el-col :span="12" >
                    <el-card >
                        <h4>PageRank节点重要性排名</h4>
                        <div id="pageRankColumn" style="width:520px;height:300px"></div>
                    </el-card>
                    
                </el-col>
                <el-col :span="12" >
                    <el-card>
                        <h4>节点桑基图</h4>
                        <div id="sanky" style="width:520px;height:300px"></div>
                    </el-card>

                </el-col>
            </el-row>
        </div>
    </div>
    
</template>

<script>

import G6 from '@antv/g6';
import insertCss from 'insert-css';
import { Column } from '@antv/g2plot';

import { pageRank } from "@antv/algorithm";
import { Sankey } from '@antv/g2plot';
import CompanyInfo from "./component/CompanyInfo"

export default {
    data() {
        return {
            siteId: '',
            sitesInfo: [],
            dialogTableVisible: false,
            dialogFormVisible: false,
            formLabelWidth: '120px',
            form: {
                name: '',
                region: '',
                date1: '',
                date2: '',
                delivery: false,
                type: [],
                resource: '',
                desc: ''
            },
            tableData: [{
                date: '2016-05-02',
                name: '王小虎',
                address: '上海市普陀区金沙江路 1518 弄'
                }, {
                date: '2016-05-04',
                name: '王小虎',
                address: '上海市普陀区金沙江路 1517 弄'
                }, {
                date: '2016-05-01',
                name: '王小虎',
                address: '上海市普陀区金沙江路 1519 弄'
                }, {
                date: '2016-05-03',
                name: '王小虎',
                address: '上海市普陀区金沙江路 1516 弄'
            }],

            drawer: false,
            direction: 'rtl',

            graph:'',
        };
    },
    components:{
        CompanyInfo,
    },
    created(){
        this.siteId= this.$route.query.id;
        this.getSiteInfo();
        // this.$watch(
        //     () => this.$route.query,
        // )
    },
    methods:{
        getSiteInfo(){
            //监听url的id属性，将id传给这里查询
            // console.log(this.$route.$query.id)
            this.axios({
                url:"api/sites/id/",
                method: 'get',
                params:{"id":this.siteId}
            }).then(res=>{
                console.log(res.data.data);
                this.sitesInfo = res.data.data;
            })
        },
        formatter(row, column) {
            return row.address;
        },
        handleClose(done) {
        this.$confirm('确认关闭？')
          .then(_ => {
            done();
          })
          .catch(_ => {});
      },
        showGraph(){
            const container = document.getElementById('container');
            const width = container.scrollWidth;
            const height = container.scrollHeight || 450; //这里修改画布的高度
            insertCss(`
            .g6-component-tooltip {
                background-color: rgba(255, 255, 255, 0.8);
                padding: 0px 10px 24px 10px;
                box-shadow: rgb(174, 174, 174) 0px 0px 10px;
            }
            `);
            ////https://gw.alipayobjects.com/os/antvdemo/assets/data/relations.json
            fetch('api/graph/test') //http://localhost:8888/graph/test
            .then((res) => res.json())
            .then((data) => {
                this.graph = data;
                const subjectColors = [
                    '#5F95FF', // blue
                    '#61DDAA',
                    '#65789B',
                    '#F6BD16',
                    '#7262FD',
                    '#78D3F8',
                    '#9661BC',
                    '#F6903D',
                    '#008685',
                    '#F08BB4',
                ];
                const backColor = '#fff';
                const theme = 'default';
                const disableColor = '#777';
                const colorSets = G6.Util.getColorSetsBySubjectColors(
                    subjectColors,
                    backColor,
                    theme,
                    disableColor,
                );
                // console.log(colorSets);

                //PageRank算法结果展示
                let result = pageRank(data); //return Object[id: pagerank] 
                this.showPageRankColumn(result);
                // console.log(result);
                //桑基图
                this.showSanky(data.edges);

                //分类
                const clusterMap = new Map();
                let clusterId = 0;
                data.nodes.forEach(function (node) {
                    // cluster
                    if (node.label && clusterMap.get(node.label) === undefined) {
                        clusterMap.set(node.label, clusterId);
                        clusterId++;
                    }
                    node.legendType=node.label;
                    const cid = clusterMap.get(node.label);
                    if (!node.style) {
                        node.style = {};
                    }
                    node.style.fill = colorSets[cid].mainFill; //subjectColors
                    node.style.stroke = colorSets[cid].mainStroke; //strokes[cid % strokes.length];

                });
                
                const clusterEdgeMap = new Map();
                let clusterId1 = 0;
                data.edges.forEach(edge => {
                    if (edge.label && clusterEdgeMap.get(edge.label) === undefined) {
                        clusterEdgeMap.set(edge.label, clusterId1);
                        clusterId1++;
                    }
                    edge.legendType=edge.label;
                    const cid = clusterEdgeMap.get(edge.label);
                    edge.style = {
                        stroke: colorSets[cid].mainStroke,
                    };
                    edge.labelCfg={
                        autoRotate: true,
                        style: {
                            lineWidth: 4,
                            fill: colorSets[cid].mainStroke, //colorSets[i].mainStroke, //'#1890ff',  //文字颜色
                            fontSize: 14,
                            background: {
                                fill: colorSets[cid].mainFill, //colorSets[i].mainFill
                                stroke: colorSets[cid].mainStroke,
                                padding: [2, 2, 2, 2],
                                radius: 2,
                            },
                        },
                    };
                })



                // data.nodes.forEach((node,i) => {
                //     node.legendType=node.label;
                //     if(node.label==="Domain"){
                //         node.style = {
                //             fill: colorSets[0].mainFill, //colorSets[i].mainFill
                //             stroke: colorSets[0].mainStroke,
                //             // fill:'#61DDAA',
                //         }; 
                //         node.img="https://gw.alipayobjects.com/os/s/prod/antv/assets/image/logo-with-text-73b8a.svg";
                //     }else if(node.label==="Ip"){
                //         node.style = {
                //             fill: colorSets[1].mainFill,
                //             stroke: colorSets[1].mainStroke,
                //             // fill:'#9661BC',
                //         };
                //     }else if(node.label==="Company"){
                //         node.style = {
                //             fill: colorSets[2].mainFill,
                //             stroke: colorSets[2].mainStroke,
                //             // fill:'#F6BD16',
                //         };
                //     }else if(node.label==="Person"){
                //         node.style = {
                //             fill: colorSets[3].mainFill,
                //             stroke: colorSets[3].mainStroke,
                //             // fill:'#F6BD16',
                //         };
                //     }
                // }
                // );
                // data.edges.forEach((edge,i)=>{
                //     edge.legendType=edge.label;
                //     edge.labelCfg={
                //         autoRotate: true,
                //         style: {
                //             lineWidth: 4,
                //             fill:'#1890ff', //colorSets[i].mainStroke, //'#1890ff',  //文字颜色
                //             fontSize: 14,
                //             background: {
                //                 fill: colorSets[0].mainFill, //colorSets[i].mainFill
                //                 stroke: colorSets[0].mainStroke,
                //                 // fill: '#78D3F8',
                //                 // stroke: '#78D3F8',
                //                 padding: [2, 2, 2, 2],
                //                 radius: 2,
                //             },
                //         },
                //     }
                    
                    
                // })
                const nodeLegendSize = 15;
                const typeConfigs = {
                    'Domain': {
                        type: 'circle',
                        // size: 20,
                        r:nodeLegendSize, //图例节点的大小
                        style: {
                            fill: '#61DDAA',
                        }
                    },
                    'Ip': {
                        type: 'circle',
                        // size: 20,
                        r:nodeLegendSize,
                        style: {
                            fill: '#9661BC'
                        }
                    },
                    'Company': {
                        type: 'circle',
                        // size: 20,
                        r:nodeLegendSize,
                        style: {
                        fill: '#F6BD16'
                        }
                    },
                    'Cert': {
                        type: 'circle',
                        // size: 20,
                        r:nodeLegendSize,
                        style: {
                            fill: '#008685',
                        }
                    },
                    'Person':{
                        type: 'circle',
                        // size: 20,
                        r:nodeLegendSize,
                        style: {
                            fill: '#7262FD',
                        }
                    },
                    //
                    'HAS_IP': {
                        type: 'line',
                        style: {
                        width: 20,
                        stroke: '#F6BD16',
                        }
                    },
                    'HAS_CERT': {
                        type: 'line',
                        style: {
                        width: 20,
                        stroke: '#78D3F8',
                        }
                    },
                    'FOUNDED_BY': {
                        type: 'line',
                        style: {
                        width: 20,
                        stroke: '#008685',
                        }
                    },
                    'IS_SUB':{
                        type: 'line',
                        style: {
                        width: 20,
                        stroke: '#008685',
                        }
                    },
                    'WORKS_FOR':{
                        type: 'line',
                        style: {
                        width: 20,
                        stroke: '#008685',
                        }
                    }
                }

                //图标
                data.nodes.forEach(node => {
                    if (!node.legendType) return;
                    node = Object.assign(node, {...typeConfigs[node.legendType]});
                })
                data.edges.forEach(edge => {
                    if (!edge.legendType) return;
                    const config = typeConfigs[edge.legendType];
                    edge = Object.assign(edge, {...config});
                })

                const legendData = {
                    nodes: [{
                        id: 'Domain',
                        label: 'Domain',
                        order: 0,
                        ...typeConfigs['Domain']
                    }, {
                        id: 'Ip',
                        label: 'Ip',
                        order: 1,
                        ...typeConfigs['Ip']
                    }, {
                        id: 'Company',
                        label: 'Company',
                        order: 2,
                        ...typeConfigs['Company']
                    },{
                        id: 'Cert',
                        label: 'Cert',
                        order: 3,
                        ...typeConfigs['Cert']
                    },{
                        id: 'Person',
                        label: 'Person',
                        order: 4,
                        ...typeConfigs['Person']
                    },
                    ],
                    edges: [{
                        id: 'HAS_IP',
                        label: 'HAS_IP',
                        order: 2,
                        ...typeConfigs['HAS_IP']
                    }, {
                        id: 'HAS_CERT',
                        label: 'HAS_CERT',
                        ...typeConfigs['HAS_CERT']
                    }, {
                        id: 'FOUNDED_BY',
                        label: 'FOUNDED_BY',
                        ...typeConfigs['FOUNDED_BY']
                    },{
                        id: 'IS_SUB',
                        label: 'IS_SUB',
                        ...typeConfigs['IS_SUB']
                    },
                    {
                        id: 'WORKS_FOR',
                        label: 'WORKS_FOR',
                        ...typeConfigs['WORKS_FOR']
                    }
                ]
                
                }
                const legend = new G6.Legend({
                    data: legendData,
                    align: 'center',
                    layout: 'vertical', // vertical  图标水平或竖直  horizontal
                    position: 'bottom-left',  //图标的位置
                    vertiSep: 12,
                    horiSep: 24,
                    offsetX: 25, //图例区域离 position 对应的默认位置的 x 方向的偏移量，可被用于图例位置的微调
                    offsetY: -24,
                    padding: [4, 16, 8, 16], //图例区域内部内容到边框的距离，四位数组分别代表上、右、下、左边距
                    containerStyle: {
                        fill: '#ccc',
                        lineWidth: 1
                    },
                    title: '图例说明',
                    titleConfig: {
                        position: 'center',
                        offsetX: 0,
                        offsetY: 12,
                    },
                    filter: {
                        enable: true,
                        trigger: 'mouseenter',
                        graphActiveState: 'activeByLegend',
                        graphInactiveState: 'inactiveByLegend',
                        filterFunctions: {
                            'Domain': (d) => {
                                if (d.legendType === 'Domain') return true;
                                return false
                            },
                            'Ip': (d) => {
                                if (d.legendType === 'Ip') return true;
                                return false
                            },
                            'Company': (d) => {
                                if (d.legendType === 'Company') return true;
                                return false
                            },
                            'Cert': (d) => {
                                if (d.legendType === 'Cert') return true;
                                return false
                            },
                            'Person': (d) => {
                                if (d.legendType === 'Person') return true;
                                return false
                            },
                            //edge
                            'HAS_IP': (d) => {
                                if (d.legendType === 'HAS_IP') return true;
                                return false
                            },
                            'HAS_CERT': (d) => {
                                if (d.legendType === 'HAS_CERT') return true;
                                return false
                            },
                            'FOUNDED_BY': (d) => {
                                if (d.legendType === 'FOUNDED_BY') return true;
                                return false
                            },
                            'IS_SUB': (d) => {
                                if (d.legendType === 'IS_SUB') return true;
                                return false
                            },
                            'WORKS_FOR': (d) => {
                                if (d.legendType === 'WORKS_FOR') return true;
                                return false
                            },
                        }
                    }
                });

                //tooltip
                const tooltip = new G6.Tooltip({
                    offsetX: 10,
                    offsetY: 10,
                    // the types of items that allow the tooltip show up
                    // 允许出现 tooltip 的 item 类型
                    itemTypes: ['node', 'edge'],
                    // custom the tooltip's content
                    // 自定义 tooltip 内容
                    getContent: (e) => {
                        const outDiv = document.createElement('div');
                        outDiv.style.width = 'fit-content';
                        //outDiv.style.padding = '0px 0px 20px 0px';
                        outDiv.innerHTML = `

                        <h4>节点信息</h4>
                        <ul>
                            <li>节点类型: ${e.item.getType()}</li>
                        </ul>                        
                        <ul>
                            <li>节点名称: ${e.item.getModel().properties["name"] || e.item.getModel().id}</li>
                        </ul>
                        <ul>
                            <li>PageRank: ${result[e.item.getModel().id]}</li>
                        </ul>

                        `;
                        return outDiv;
                    },
                });



                const graph = new G6.Graph({
                    container: 'container',
                    width,   //: 800,
                    height,//: 500,
                    fitCenter: true,
                    modes: {
                        default: ['drag-canvas', 'activate-relations'],
                    },
                    layout: {
                        type: 'force',
                        linkDistance: 180, //边的长度 250
                        preventOverlap: true,
                        nodeStrength: -170,  //节点的引力，负数代表斥力
                        // center: [width / 2, height / 2],
                    },
                    defaultNode: {
                        size: 20,
                        /* node type */
                        type: 'circle',
                        /* node size */
                        // size: [60],
                        /* style for the keyShape */
                        style: {
                        // fill: '#9EC9FF',
                        // stroke: '#5B8FF9',
                        lineWidth: 2,
                        },
                        labelCfg: {
                        /* label's position, options: center, top, bottom, left, right */
                            position: 'bottom',
                            /* label's offset to the keyShape, 4 by default */
                            //   offset: 12,
                            /* label's style */
                            //   style: {
                            //     fontSize: 20,
                            //     fill: '#ccc',
                            //     fontWeight: 500
                            //   }
                        },
                        icon: {
                            /* whether show the icon, false by default */
                            show: true,
                            /* icon's img address, string type */
                            // TODO:《在vue中使用阿里巴巴svg图标》 https://blog.csdn.net/weixin_44867717/article/details/108698021
                            img: 'https://gw.alipayobjects.com/zos/basement_prod/012bcf4f-423b-4922-8c24-32a89f8c41ce.svg',
                            
                            /* icon's size, 20 * 20 by default: */
                            //   width: 40,
                            //   height: 40
                        },
                    },
                    defaultEdge: {
                        // labelCfg: {
                        //     autoRotate: true,
                        //     style: {
                        //         lineWidth: 4,
                        //         fill: '#1890ff',
                        //         fontSize: 14,
                        //         background: {
                        //             fill: '#ffffff',
                        //             stroke: '#9EC9FF',
                        //             padding: [2, 2, 2, 2],
                        //             radius: 2,
                        //         },
                        //     },
                        // },
                    },
                    nodeStateStyles: {
                        activeByLegend: {
                        lineWidth: 10,
                        strokeOpacity: 0.5
                        },
                        inactiveByLegend: {
                        opacity: 0.5
                        }
                    },
                    edgeStateStyles: {
                        activeByLegend: {
                        lineWidth: 3
                        },
                        inactiveByLegend: {
                        opacity: 0.5
                        }
                    },
                    animate: true,
                    plugins: [legend,tooltip],
                });
                graph.data({
                    nodes: data.nodes,
                    edges: data.edges.map(function (edge, i) {
                        edge.id = 'edge' + i;
                        return Object.assign({}, edge);
                    }),
                    // edges: this.graphData.edges
                });
                graph.render();

                graph.on('node:dragstart', function (e) {
                graph.layout();
                refreshDragedNodePosition(e);
                });
                graph.on('node:drag', function (e) {
                const forceLayout = graph.get('layoutController').layoutMethods[0];
                forceLayout.execute();
                refreshDragedNodePosition(e);
                });
                graph.on('node:dragend', function (e) {
                e.item.get('model').fx = null;
                e.item.get('model').fy = null;
                });

                // graph.on('node:mouseenter', (evt) => {
                // const { item } = evt;
                // graph.setItemState(item, 'active', true);
                // });

                // graph.on('node:mouseleave', (evt) => {
                // const { item } = evt;
                // graph.setItemState(item, 'active', false);
                // });

                if (typeof window !== 'undefined')
                window.onresize = () => {
                    if (!graph || graph.get('destroyed')) return;
                    if (!container || !container.scrollWidth || !container.scrollHeight) return;
                    graph.changeSize(container.scrollWidth, container.scrollHeight);
                };
            });

            function refreshDragedNodePosition(e) {
            const model = e.item.get('model');
            model.fx = e.x;
            model.fy = e.y;
            }
        },

        showPageRankColumn(rankResult){
            const data = []
            for(var key in rankResult){
                var nodeName;
                var nodeType;
                this.graph.nodes.forEach(node => {
                    if(node["id"]==key){
                        nodeName = node.properties["name"];
                        nodeType = node.label;
                    }
                });
                data.push({
                    nodeId:key,
                    nodeName: nodeName,
                    pageRankValue: rankResult[key],
                    nodeType: nodeType,
                })
            }

            const paletteSemanticRed = '#F4664A';
            const brandColor = '#5B8FF9';
            const columnPlot = new Column('pageRankColumn', { //dom节点的id
                data, //数据
                xField: 'nodeName',
                yField: 'pageRankValue',
                seriesField: '',
                color: ({ nodeName }) => {
                    // if (nodeName === 'sub50') {
                    //     return paletteSemanticRed;
                    // }
                    return brandColor;
                },
                label: {
                    // position: 'middle', // 'top', 'bottom', 'middle',
                    // // 配置样式
                    // style: {
                    //     fill: '#6FFFFF',
                    //     opacity: 0.6,
                    // },
                    content: (originData) => {
                    const val = parseFloat(originData.value);
                    if (val < 0.05) {
                        return (val * 100).toFixed(1) + '%';
                    }
                    },
                    offset: 10,
                },
                legend: false,
                xAxis: {
                    label: {
                    autoHide: true,
                    autoRotate: true,
                    // rotate:30,
                    },
                },
                columnStyle: { //圆角
                    radius: [5, 5, 0, 0],
                },
            });

            columnPlot.render();
        },
        //桑吉图渲染 注意边需要有value
        showSanky(originEdges){   
            const edges = []; //新建一个数组，如果直接对原数组赋值的话，会直接改变原数组，导致图无法正确显示。
            for(var key in originEdges){
                edges.push({});
                edges[key]["value"]=1;
                //将id替换为name
                this.graph.nodes.forEach(node => {
                    if(node["id"]==originEdges[key]["source"]){
                        edges[key]["source"] = node.properties["name"];
                    }
                    if(node["id"]==originEdges[key]["target"]){
                        edges[key]["target"] = node.properties["name"];
                    }
                });
            }
            const sankey = new Sankey('sanky', {
            data: edges,
            sourceField: 'source',
            targetField: 'target',
            weightField: 'value',
            nodeWidthRatio: 0.008,
            nodePaddingRatio: 0.03,
            });
            sankey.render();
        },

        louvain(){
            const { louvain } = G6.Algorithm;

            const button = document.createElement('button');
            button.innerHTML = `Click Here to Clustering 点此自动聚类`;
            document.getElementById('container').appendChild(button);

            // Generate color sets according to subject colors
            const subjectColors = [
            // '#5F95FF', // blue
            '#61DDAA',
            '#65789B',
            '#F6BD16',
            '#7262FD',
            '#78D3F8',
            '#9661BC',
            '#F6903D',
            '#008685',
            '#F08BB4',
            ];
            const colorSets = G6.Util.getColorSetsBySubjectColors(subjectColors, '#fff', 'default', '#777');

            const container = document.getElementById('container');
            const width = container.scrollWidth;
            const height = (container.scrollHeight || 500) - 20;

            const graph = new G6.Graph({
            container: 'container',
            width: 800,
                height: 500,
            linkCenter: true,
            modes: {
                default: ['drag-canvas', 'drag-node', 'zoom-canvas'],
            },
            layout: {
                type: 'gForce',
                minMovement: 0.1,
            },
            });
            //api/graph/test
            //https://gw.alipayobjects.com/os/antvdemo/assets/data/relations.json
            fetch('api/graph/test')
            .then((res) => res.json())
            .then((data) => {
                graph.data(data);
                graph.render();

                button.addEventListener('click', (e) => {
                const clusteredData = louvain(data, false);
                
                clusteredData.clusters.forEach((cluster, i) => {
                    const colorSet = colorSets[i % colorSets.length];
                    cluster.nodes.forEach((node) => {
                    const model = graph.findById(node.id).getModel();
                    model.style.fill = colorSet.mainFill
                    model.style.stroke = colorSet.mainStroke
                    });
                });
                graph.refresh();
                });
            });

            if (typeof window !== 'undefined')
            window.onresize = () => {
                if (!graph || graph.get('destroyed')) return;
                if (!container || !container.scrollWidth || !container.scrollHeight) return;
                graph.changeSize(container.scrollWidth, container.scrollHeight - 20);
            };

        },
    },
    mounted(){
        // this.getSiteInfo()
        this.showGraph();
    },
}
</script>

<style scoped>
    .site-location{
        margin-right: 90px;
    }
    .graph-analyse{
        margin-top:20px
    }
    .graph-container{
        display:flex;
        margin-bottom:30px;
        scrollWidth:500px;
        scrollHeight:300px;
    }
</style>
