<template>
  <div class="dashboard-editor-container">
    <!-- (TODO:网站搜索框应该一直固定在顶部) -->
    <!-- <Search @getSearchResult="getSearchResult" /> -->
    <div style="margin-top: 15px;width:500px;margin-left:30px;">
      <el-input placeholder="请输入内容" v-model="search.input3" class="input-with-select" clearable>
        <el-select v-model="search.select" slot="prepend" placeholder="请选择" >
          <el-option
            v-for="item in search.category"
            :key="item.value"
            :label="item.label"
            :value="item.value">
          </el-option>
        </el-select>
        <el-button slot="append" icon="el-icon-search" @click="Search(1)"></el-button>
      </el-input>
    </div>

    <!-- 相关结果统计 -->
    <el-row :gutter="15">
      <el-col :span="6">
        <el-card class="box-card" shadow="always" style="box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04">
          <div class="result-text">相关结果：<span class="result-text"  style="font-weight: 700;">{{sitesInfoByPage.total}}</span></div>
          <div  class="result-text">相关IP：<span class="result-text" style="font-weight: 700;">0</span></div>
          <div class="result-text">相关公司：<span class="result-text" style="font-weight: 700;">0</span></div>
          <ResultFolder :sitesInfoByPage="sitesInfoByPage"/>
        </el-card>

      </el-col>

      <!-- 网站信息卡片 -->
      <el-col :span="18">
          <SiteInfoCard :sitesInfoByPage="sitesInfoByPage.records"/>
      </el-col>
    </el-row>

    <!-- Botton page分页 -->
    <!-- <BottomPage :totalCount="sitesInfoByPage.total" :currentPage="sitesInfoByPage.current" /> -->
    <el-row :gutter="20">
      <el-col :span="12" :offset="6">
        <div class="pagination">
          <el-pagination
            @size-change="handleSizeChange"
            @current-change="handleCurrentChange"
            :current-page.sync="paginations.currentPage"
            :page-size="paginations.pageSize"
            :layout="paginations.layout"
            :total="paginations.totalPage">
          </el-pagination>
        </div>
      </el-col>
    </el-row>
  </div>
</template>

<script>

import Search from "./component/search"
import ResultFolder from "./component/ResultFolder"
import SiteInfoCard from "./component/SiteInfoCard"
import BottomPage from "./component/BottomPage"

export default {
  data() {
    return {
      sitesInfoByPage:{},
      search:{
        input3: '',
        select:'',
        category:[
          {
            label:" ",
            value:"1",
          },
          {
            label:"IP",
            value:"ip",
          },
          {
            label:"URL",
            value:"url",
          },
          {
            label:"端口",
            value:"port",
          },
          {
            label:"公司",
            value:"company",
          },
          {
            label:"国家",
            value:"country",
          },
          {
            label:"网站标题",
            value:"siteTitle",
          },

        ],
      },
      paginations:{
        currentPage: 1,
        totalPage: '',
        pageSize: 10,
        layout:"total, prev, pager, next, jumper",
      }
    };
  },
  components:{
    Search,
    ResultFolder,
    SiteInfoCard,
    BottomPage
    // AreaResult
  },
  methods:{
    //分页
    handleSizeChange(val) {
        console.log(`每页 ${val} 条`);
    },
    handleCurrentChange(val) { //当前页val
      this.paginations.currentPage=val;
      this.Search(val);
      // console.log(`当前页: ${val}`);
    },

    Search(page){ //
      this.axios({
        url:"api/sites/?"+`${this.search.select}`+ "="+ `${this.search.input3}`,
        method: 'get',
        params:{
          "page":page,
          "limit":9
        }
      }).then(res=>{
        console.log(res);
        this.sitesInfoByPage = res.data.data;
        this.paginations.currentPage = page;
        this.paginations.totalPage = res.data.data.total;
      })
    },

    //搜索结果
    getSearchResult(sitesInfoByPage){ //sitesInfoByPage从子组件里传入
      this.sitesInfoByPage=sitesInfoByPage;
      console.log(this.sitesInfoByPage)
    },


  },
  created(){
    this.Search(1);
  },
  mounted(){
    
  },

}
</script>


<style scoped>
  .box-card{
    margin-top: 20px;
    margin-left: 20px;

  }
  .side-bar {
    width: 30%;
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    overflow: hidden;
}
  .result-text{
    font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;
    font-size: 14px;
    line-height: 1.7692307692;
  }

  .pagination{
    margin: 30px;
  }
</style>

