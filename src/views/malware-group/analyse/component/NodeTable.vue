<template>
    <div>
        <el-input placeholder="查询节点名称" clearable style="width:100%" v-model="search.node">
            <el-button slot="append" icon="el-icon-search"></el-button>
        </el-input>
        <!-- :data="currentPageData()"   改为filteredData -->
        <el-table :data="currentPageData()" @filter-change="handleFilterChange" ref="filterTable" 
            size="small" class="tableBox"   border style="width: 100%">
            <el-table-column prop="id"
                label="id"
                :show-overflow-tooltip=true
            >
            </el-table-column>

            <el-table-column
                prop="label"
                label="节点类型"
                :show-overflow-tooltip=true
                :filters="[{ text: 'Website', value: 'Website' }, { text: 'Redirect', value: 'Redirect' }]"
                :filter-method="filterTag"
                filter-placement="bottom-end"
            >
            <!-- 彩色按钮 -->
            <template slot-scope="scope">
                <!-- TODO:修改分类判断颜色 -->
                <el-tag size="mini"
                  :type="scope.row.label === 'Website' ? 'primary' : 'success'" 
                  disable-transitions>{{scope.row.label}}</el-tag>
              </template>
            </el-table-column>

            <el-table-column
                prop="properties.name"
                :show-overflow-tooltip=true
                label="节点名称">
            </el-table-column>
        </el-table>
        <div class="block" style="margin-top:1px">
            <el-pagination
              layout="prev, pager, next"
              @current-change="handleCurrentChange"
              :current-page.sync="currentPage"
              :page-size="pageSize"
              :total="total()"
              >
            </el-pagination>
        </div>
    </div>

</template>

<script>
export default {
    props: {
        graphData: {
        type: Array,
        required: true
        }
    },
    data() {
        return {
            search:{
                "node":'',
            },
            currentPage: 1,
            pageSize: 5,
            tableData:[],
            filteredData:[],
        }
    },
    watch: { 
        graphData (val) {
            this.filteredData = val
            // this.total = this.graphData.nodes.length
            console.log("watch")
            console.log(this.filteredData)

        },
        // graphData: {
        //     handler: function(newVal, oldVal) {
        //     // 异步数据到达时更新计算属性
        //         this.$nextTick(() => {
        //             this.tableData = newVal;
        //             console.log(this.tableData)
        //         });
        //     },
        //     immediate: true, // 立即执行第一次
        // },
    },
    
    computed: {
        // tableData: {
        //     set (value) {
        //         console.log("computed-set")
        //         console.log(value)
        //         // this.update()
        //     },
        //     get () {
        //         return this.test
        //     }
        // },
            // total() {
            //     return this.graphData.nodes.length
            // },
            // currentPageData() {

            //     const start = (this.currentPage - 1) * this.pageSize
            //     const end = start + this.pageSize
            //     return this.graphData.nodes.slice(start, end)
            // }
    },

    methods: {
        //分页
        total() {
            // this.total = this.graphData.nodes.length
            return this.graphData.nodes.length
        },
        currentPageData() {
            const start = (this.currentPage - 1) * this.pageSize
            const end = start + this.pageSize
            // return this.graphData.nodes.slice(start, end)
            return this.graphData.nodes.slice(start, end)
        },
        handleCurrentChange(currentPage) {
            this.currentPage = currentPage
        },
        //过滤
        clearFilter() {
            this.$refs.filterTable.clearFilter();
        },
        filterTag(value, row) {
            const labelToFilter = "Redirect"; // 你要过滤的 label
            const filteredNodes = this.graphData.nodes.filter(node => node.label === labelToFilter);
            console.log(filteredNodes);

            return row.label === value;
        },
        handleFilterChange(filters) {
            console.log(filters)
            console.log(filters.el-table_2_column_5)
            const filteredNodes = this.graphData.nodes.filter(node => filters["el-table_2_column_5"].includes(node.label));
            console.log(filteredNodes);
            // this.filteredData = this.graphData.nodes.filter(node => {
            //     // 根据过滤条件过滤数据
            //     console.log(node)
            //     if(node.label in filters){
            //         console.log("yes")
            //         return node
            //     }
            //     // const nameFilter = filters.name ? item.name.toLowerCase().includes(filters.name.toLowerCase()) : true;
            //     // const ageFilter = filters.age ? item.age >= filters.age : true;
            //     // return nameFilter && ageFilter;
            // });
            // console.log(this.filteredData)
            this.total = this.filteredData.length;  // 更新总数据量
            this.currentPage = 1;  // 重置当前页数为第一页
        }

        
    }
}
</script>

<style scoped>

    /deep/.el-table--border .el-table__cell {
        border-right: 1px solid #ffffff;
    }

    
    /deep/ .el-input__inner{
        border: 1px solid #DCDFE6;
        height: 30px;
       
        /*border-radius: 24px;*/
    }

    /deep/.el-table__header {
        background-color: #555454 !important;
      }

</style>