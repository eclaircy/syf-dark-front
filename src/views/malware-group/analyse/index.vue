<template>
    <div class="page-container">
        <!-- <router-view /> -->
        <el-row>
            <el-card>
                 <div style="font-size: 20px;margin-bottom: 7px;">团伙挖掘与分析</div>
                 <span>追踪团伙构成恶意下载网站、背后公司组成、涉及人员</span>
                  <a-tag color="#654E92" style="float:right;">当前团伙：c{{ cid }}</a-tag>      
            </el-card>
        </el-row>

        <el-row>
            <el-card>
                <!-- <MyPanelCard header="相关网站" countNumber="21" style="margin-right:20px"/>
                <MyPanelCard header="相关公司" countNumber="14" style="margin-right:20px"/>
                <MyPanelCard header="相关人员" countNumber="14" style="margin-right:20px"/>
                <MyPanelCard header="相关IP" countNumber="21" style="margin-right:20px"/>
                <MyPanelCard header="跳转链接" countNumber="31" style="margin-right:20px"/> -->
                <div class="info-box mb-3 bg-warning" style="background-color: ;">
                    <span class="info-box-icon">
                        <svg t="1686369921573" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6616" width="40" height="40"><path d="M456.906218 294.964942c-42.228777 10.670014-79.681784 33.305547-108.548228 64.070224 26.117844 8.246825 53.705156 14.551414 82.46313 18.790972C437.532985 348.515578 446.249507 320.691883 456.906218 294.964942z" p-id="6617" data-spm-anchor-id="a313x.7781069.0.i47" class="selected" fill="#DD6572"></path><path d="M424.566672 409.362388c-34.660404-4.920056-67.606771-12.549827-98.240465-22.73684-21.435195 31.585369-34.989909 68.920696-37.855166 109.256356l128.071887 0C417.34213 466.135416 419.84002 437.089893 424.566672 409.362388z" p-id="6618" data-spm-anchor-id="a313x.7781069.0.i46" class="selected" fill="#DD6572"></path><path d="M416.542928 527.876596 288.471041 527.876596c2.864234 40.33566 16.419971 77.670987 37.855166 109.257379 30.633694-10.187013 63.580061-17.819854 98.240465-22.73991C419.84002 586.66656 417.34213 557.621037 416.542928 527.876596z" p-id="6619" data-spm-anchor-id="a313x.7781069.0.i39" class="selected" fill="#DD6572"></path><path d="M560.185442 382.066719c-8.17417-33.479509-19.188015-65.027016-32.810267-93.384877-5.15337-0.354064-10.288321-0.783853-15.532765-0.783853-5.242398 0-10.377348 0.429789-15.530718 0.783853-13.622252 28.358885-24.636097 59.906391-32.810267 93.384877 15.910365 1.384533 32.027437 2.218528 48.342008 2.218528C528.156982 384.285247 544.275077 383.450229 560.185442 382.066719z" p-id="6620" data-spm-anchor-id="a313x.7781069.0.i48" class="selected" fill="#DD6572"></path><path d="M566.856375 413.380912c-17.998933 1.577938-36.323277 2.505054-55.013965 2.505054-18.690688 0-37.014009-0.926092-55.012941-2.505054-4.824889 26.615171-7.380084 54.332443-8.233522 82.500992l126.494972 0C574.23646 467.713354 571.681264 439.996083 566.856375 413.380912z" p-id="6621" data-spm-anchor-id="a313x.7781069.0.i45" class="selected" fill="#DD6572"></path><path d="M675.326832 359.035166c-28.866445-30.764678-66.320475-53.400211-108.549252-64.070224 10.657734 25.725918 19.373233 53.549613 26.085098 82.861196C621.621677 373.587604 649.207965 367.283014 675.326832 359.035166z" p-id="6622" data-spm-anchor-id="a313x.7781069.0.i49" class="selected" fill="#DD6572"></path><path d="M456.828446 610.375541c17.998933-1.577938 36.323277-2.506077 55.012941-2.506077 18.690688 0 37.015032 0.928139 55.014988 2.506077 4.824889-26.615171 7.379061-54.331419 8.233522-82.497922L448.595948 527.877619C449.449385 556.044122 452.003558 583.76037 456.828446 610.375541z" p-id="6623" data-spm-anchor-id="a313x.7781069.0.i38" class="selected" fill="#DD6572"></path><path d="M607.14087 495.881904l128.072911 0c-2.864234-40.33566-16.418948-77.673034-37.855166-109.258403-30.633694 10.188037-63.580061 17.817808-98.241488 22.737864C603.844801 437.089893 606.341668 466.136439 607.14087 495.881904z" p-id="6624" data-spm-anchor-id="a313x.7781069.0.i44" class="selected" fill="#DD6572"></path><path d="M511.706311 0.060375c-282.59624 0-511.684822 229.089605-511.684822 511.684822s229.089605 511.684822 511.684822 511.684822 511.684822-229.089605 511.684822-511.684822S794.301528 0.060375 511.706311 0.060375zM511.842411 767.856225c-141.371798 0-255.977999-114.606201-255.977999-255.976976 0-141.374868 114.606201-255.976976 255.977999-255.976976 141.372821 0 255.977999 114.602108 255.977999 255.976976C767.82041 653.250024 653.215232 767.856225 511.842411 767.856225z" p-id="6625" data-spm-anchor-id="a313x.7781069.0.i35" class="selected" fill="#DD6572"></path><path d="M599.117127 614.394065c34.661428 4.920056 67.607794 12.551874 98.241488 22.73991 21.435195-31.585369 34.990932-68.920696 37.855166-109.257379L607.14087 527.876596C606.341668 557.621037 603.844801 586.66656 599.117127 614.394065z" p-id="6626" data-spm-anchor-id="a313x.7781069.0.i37" class="selected" fill="#DD6572"></path><path d="M566.777581 728.792535c42.228777-10.66899 79.682807-33.3035 108.549252-64.070224-26.117844-8.246825-53.706179-14.551414-82.464153-18.789948C586.150814 675.241898 577.434292 703.06764 566.777581 728.792535z" p-id="6627" data-spm-anchor-id="a313x.7781069.0.i43" class="selected" fill="#DD6572"></path><path d="M348.357989 664.72231c28.866445 30.765701 66.320475 53.401234 108.548228 64.070224-10.656711-25.724895-19.373233-53.549613-26.085098-82.860173C402.063145 650.169873 374.476857 656.474462 348.357989 664.72231z" p-id="6628" data-spm-anchor-id="a313x.7781069.0.i41" class="selected" fill="#DD6572"></path><path d="M463.500403 641.692804c8.17417 33.479509 19.188015 65.027016 32.810267 93.383854 5.15337 0.355087 10.288321 0.785899 15.530718 0.785899 5.244444 0 10.379395-0.429789 15.532765-0.785899 13.622252-28.356838 24.636097-59.905368 32.810267-93.383854-15.910365-1.384533-32.027437-2.219551-48.343031-2.219551C495.526817 639.47223 479.409744 640.308271 463.500403 641.692804z" p-id="6629" data-spm-anchor-id="a313x.7781069.0.i42" class="selected" fill="#DD6572"></path></svg>    
                    </span>
                    <div class="info-box-content">
                        <span class="info-box-text">相关网站</span>
                        <span class="info-box-number">{{labelCounts.Website==undefined?0:labelCounts.Website}}</span>
                    </div>
                </div>

                <div class="info-box mb-3 bg-warning" style="background-color: ;">
                    <span class="info-box-icon">
                        <svg t="1686369510979" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1637" width="40" height="40"><path d="M1023.910943 511.999898c5.11911 317.794367-194.116663 516.825376-511.91103 511.911029-317.794367 4.914346-516.825376-194.116663-511.91103-511.911029C-4.825463 194.20553 194.205546-4.825478 511.999913 0.088868c317.794367-4.914346 516.825376 194.116663 511.91103 511.91103z" fill="#82529D" p-id="1638" data-spm-anchor-id="a313x.7781069.0.i5" class="selected"></path><path d="M1022.477592 566.671996C1006.915497 340.40732 852.318366 201.16752 614.382119 204.85328c-254.112635-4.095288-413.624112 155.416189-409.528824 409.528824-3.890524 237.936247 135.554041 392.533378 361.613952 408.095473 268.036615-16.381153 439.629192-187.97373 456.010345-455.805581z" fill="#82529D" p-id="1639" data-spm-anchor-id="a313x.7781069.0.i4" class="selected"></path><path d="M1015.515602 629.944199C985.824762 491.523456 876.480566 407.160519 716.764325 409.617692c-190.635668-3.071466-310.218084 116.51095-307.146618 307.146618-2.457173 159.716241 81.905765 269.060437 220.121743 298.751277 211.112109-34.400421 351.375731-174.664043 385.776152-385.571388z" fill="#82529D" p-id="1640" data-spm-anchor-id="a313x.7781069.0.i8" class="selected"></path><path d="M997.701098 705.707031C964.734028 646.734881 902.076118 613.153517 819.146531 614.382104c-127.1587-2.047644-206.812056 77.605712-204.764412 204.764412-1.433351 82.929587 32.352777 145.587497 91.120163 178.554567a431.233852 431.233852 0 0 0 292.198816-291.994052z" fill="#82529D" p-id="1641" data-spm-anchor-id="a313x.7781069.0.i6" class="selected"></path><path d="M286.75906 184.376839h204.764412a61.429324 61.429324 0 0 1 61.429323 61.429323v593.816795H245.806178a20.476441 20.476441 0 0 1-20.476442-20.476441V245.806162a61.429324 61.429324 0 0 1 61.429324-61.429323z" fill="#C9A5DF" p-id="1642" data-spm-anchor-id="a313x.7781069.0.i10" class=""></path><path d="M552.952795 348.188368h225.240854a61.429324 61.429324 0 0 1 61.429323 61.429324v409.528824a20.476441 20.476441 0 0 1-20.476441 20.476441H552.952795V348.188368z" fill="#e6e6e6" p-id="1643" data-spm-anchor-id="a313x.7781069.0.i16" class=""></path><path d="M286.75906 245.806162m30.714662 0l143.335088 0q30.714662 0 30.714662 30.714662l0 0q0 30.714662-30.714662 30.714662l-143.335088 0q-30.714662 0-30.714662-30.714662l0 0q0-30.714662 30.714662-30.714662Z" fill="#e6e6e6" p-id="1644" data-spm-anchor-id="a313x.7781069.0.i12" class=""></path><path d="M286.75906 368.664809m30.714662 0l143.335088 0q30.714662 0 30.714662 30.714662l0 0q0 30.714662-30.714662 30.714662l-143.335088 0q-30.714662 0-30.714662-30.714662l0 0q0-30.714662 30.714662-30.714662Z" fill="#e6e6e6" p-id="1645" data-spm-anchor-id="a313x.7781069.0.i13" class=""></path><path d="M552.952795 675.811427h286.670177v61.429324H552.952795z" fill="#C9A5DF" p-id="1646" data-spm-anchor-id="a313x.7781069.0.i11" class=""></path></svg>
                    </span>
                    <div class="info-box-content">
                        <span class="info-box-text">相关公司</span>
                        <span class="info-box-number">{{labelCounts.Company==undefined?0:labelCounts.Company}}</span>
                    </div>
                </div>

                <div class="info-box mb-3 bg-warning" style="background-color: ;">
                    <span class="info-box-icon">
                        <svg t="1686369370080" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7559" width="50" height="50"><path d="M512 85.333333c234.666667 0 426.666667 192 426.666667 426.666667s-192 426.666667-426.666667 426.666667S85.333333 746.666667 85.333333 512 277.333333 85.333333 512 85.333333z m22.613333 87.978667h-45.226666v0.768c-167.381333 11.349333-303.957333 147.925333-315.306667 315.306667h-0.768v45.226666h0.768c11.349333 167.381333 147.925333 303.957333 315.306667 315.306667v0.768h45.226666v-0.768c167.381333-11.349333 303.957333-147.925333 315.306667-315.306667h0.768v-45.226666h-0.768c-11.349333-167.381333-147.925333-303.957333-315.306667-315.306667v-0.768z m0 45.994667a292.864 292.864 0 0 1 270.08 270.08h-35.285333v45.226666h35.285333a292.864 292.864 0 0 1-270.08 270.08v-35.285333h-45.226666v35.285333a292.864 292.864 0 0 1-270.08-270.08h35.285333v-45.226666H219.306667a292.864 292.864 0 0 1 270.08-270.08v35.285333h45.226666z m4.736 305.408h-50.773333c-76.288 0-114.389333 63.530667-114.389333 177.92h275.328c4.224-114.389333-33.92-177.92-110.165334-177.92z m-25.386666-203.306667c-50.816 0-88.96 42.325333-88.96 88.96 0 46.549333 42.368 88.917333 88.96 88.917333 50.816 0 88.96-38.101333 88.96-88.917333 0-50.858667-38.144-88.96-88.96-88.96z" fill="#dd6572" p-id="7560" data-spm-anchor-id="a313x.7781069.0.i0" class="selected"></path></svg>  
                    </span>
                    <div class="info-box-content">
                        <span class="info-box-text">相关人员</span>
                        <span class="info-box-number">{{labelCounts.Person==undefined?0:labelCounts.Person}}</span>
                    </div>
                </div>
                <div class="info-box mb-3 bg-warning" style="background-color: ;">
                    <span class="info-box-icon">
                        <svg t="1686370032637" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1381" width="50" height="50"><path d="M103.185067 510.634667c0 225.518933 182.784 408.302933 408.234666 408.302933 225.4848 0 408.2688-182.784 408.2688-408.2688S736.938667 102.4 511.453867 102.4C285.969067 102.4 103.185067 285.184 103.185067 510.634667z" fill="#85C2FF" p-id="1382"></path><path d="M605.7984 474.760533l-0.682667-1.570133c-0.1024-0.1024-0.1024-0.170667-0.2048-0.341333a35.6352 35.6352 0 1 0-63.3856 32.426666c9.898667 22.357333 5.563733 49.5616-12.6976 67.925334L433.186133 669.013333a60.928 60.928 0 0 1-86.084266 0 60.928 60.928 0 0 1 0-86.084266l35.6352-35.669334-0.238934-0.238933a35.601067 35.601067 0 1 0-49.5616-50.858667l-0.1024-0.1024-36.352 36.352a132.164267 132.164267 0 0 0 0 186.948267 132.164267 132.164267 0 0 0 186.948267 0l95.914667-95.914667a132.232533 132.232533 0 0 0 26.453333-148.6848z" fill="#FFFFFF" p-id="1383"></path><path d="M731.4432 292.317867a132.164267 132.164267 0 0 0-186.948267 0l-95.914666 95.914666a132.232533 132.232533 0 0 0-26.5216 148.616534l0.682666 1.536c0.1024 0.1024 0.1024 0.2048 0.170667 0.341333a35.6352 35.6352 0 1 0 63.3856-32.426667 61.303467 61.303467 0 0 1 12.6976-67.925333l95.744-95.709867a60.928 60.928 0 0 1 86.084267 0 60.928 60.928 0 0 1 0 86.084267l-35.6352 35.6352 0.238933 0.273067a35.601067 35.601067 0 1 0 49.595733 50.858666l0.068267 0.1024 36.352-36.352a132.3008 132.3008 0 0 0 0-186.948266z" fill="#FFFFFF" p-id="1384"></path></svg>  
                    </span>
                    <div class="info-box-content">
                        <span class="info-box-text">相关链接</span>
                        <span class="info-box-number">{{labelCounts.Downlink==undefined?0:labelCounts.Downlink}}</span>
                    </div>
                </div>
                <div class="info-box mb-3 bg-warning" style="background-color: ;">
                    <span class="info-box-icon">
                        <!-- <svg t="1686320874826" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3260" id="mx_n_1686320874827" width="40" height="40" data-spm-anchor-id="a313x.7781069.0.i57"><path d="M103.185067 510.634667c0 225.518933 182.784 408.302933 408.234666 408.302933 225.4848 0 408.2688-182.784 408.2688-408.2688S736.938667 102.4 511.453867 102.4C285.969067 102.4 103.185067 285.184 103.185067 510.634667z" fill="#FCE8AA" p-id="3261" data-spm-anchor-id="a313x.7781069.0.i50" class=""></path><path d="M605.7984 474.760533l-0.682667-1.570133c-0.1024-0.1024-0.1024-0.170667-0.2048-0.341333a35.6352 35.6352 0 1 0-63.3856 32.426666c9.898667 22.357333 5.563733 49.5616-12.6976 67.925334L433.186133 669.013333a60.928 60.928 0 0 1-86.084266 0 60.928 60.928 0 0 1 0-86.084266l35.6352-35.669334-0.238934-0.238933a35.601067 35.601067 0 1 0-49.5616-50.858667l-0.1024-0.1024-36.352 36.352a132.164267 132.164267 0 0 0 0 186.948267 132.164267 132.164267 0 0 0 186.948267 0l95.914667-95.914667a132.232533 132.232533 0 0 0 26.453333-148.6848z" fill="#cdcdcd" p-id="3262" data-spm-anchor-id="a313x.7781069.0.i51" class="selected"></path><path d="M731.4432 292.317867a132.164267 132.164267 0 0 0-186.948267 0l-95.914666 95.914666a132.232533 132.232533 0 0 0-26.5216 148.616534l0.682666 1.536c0.1024 0.1024 0.1024 0.2048 0.170667 0.341333a35.6352 35.6352 0 1 0 63.3856-32.426667 61.303467 61.303467 0 0 1 12.6976-67.925333l95.744-95.709867a60.928 60.928 0 0 1 86.084267 0 60.928 60.928 0 0 1 0 86.084267l-35.6352 35.6352 0.238933 0.273067a35.601067 35.601067 0 1 0 49.595733 50.858666l0.068267 0.1024 36.352-36.352a132.3008 132.3008 0 0 0 0-186.948266z" fill="#cdcdcd" p-id="3263" data-spm-anchor-id="a313x.7781069.0.i52" class="selected"></path></svg> -->
                        <svg t="1686369069199" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8667" width="40" height="40"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#dd6572" p-id="8668" data-spm-anchor-id="a313x.7781069.0.i70" class=""></path><path d="M625.92 628.48c-1.28 3.84-3.84 8.96-6.4 11.52l-87.04 93.44c-10.24 11.52-26.88 11.52-37.12 2.56l-2.56-2.56-87.04-93.44c-2.56-3.84-5.12-7.68-6.4-11.52-85.76-62.72-103.68-183.04-42.24-268.8 62.72-85.76 183.04-103.68 268.8-42.24 85.76 62.72 103.68 183.04 42.24 268.8-12.8 16.64-26.88 30.72-42.24 42.24zM512 409.6c-35.84 0-64 28.16-64 64s28.16 64 64 64 64-28.16 64-64-28.16-64-64-64z" fill="#e6e6e6" p-id="8669" data-spm-anchor-id="a313x.7781069.0.i71" class=""></path></svg>    
                    </span>
                    <div class="info-box-content">
                        <span class="info-box-text">相关IP</span>
                        <span class="info-box-number">{{labelCounts.Ip==undefined?0:labelCounts.Ip}}</span>
                    </div>
                </div>
                
            </el-card>
        </el-row>

        <el-row :gutter=1>
            <!-- 中央 -->
            <el-col :span="15">
                <MyCard class="main-graph" header="团伙知识图谱">
                    <div class="card-body"                     
                    v-loading="loading"
                    element-loading-text="Loading"
                    element-loading-spinner="el-icon-loading"
                    element-loading-background="#343A40">
                        <GroupGraph :graphData="graphData" :cid="cid"/>
                    </div>
                </MyCard>
            </el-col>
            <!-- 最右侧 -->
            <el-col :span="9">
                <MyCard class="find-path" header="链路追踪">
                    <div class="card-body">
                        <FindPath  :graphData="graphData" style="margin:10px" />
                    </div>
                </MyCard>
            </el-col>
        </el-row>

        <el-row :gutter=2>
            <el-col :span="10">
                <MyCard header="团伙监控动态" class="timeline-container">
                    <div class="card-body">
                        <el-scrollbar style="height:360px;" wrap-style="overflow-x:hidden;"> 
                            <a-timeline mode="alternate" style="margin-top:5px;">
                                <a-timeline-item v-for="(item,index) in timelineItems" :key="index" :color="item.color">
                                    <!-- :style="{color: item.color}"-->
                                    <div style="font-weight:bold;color:#DADADA;">
                                        新增可疑{{ labelType[item.label] }}<div style="font-family:Times New Roman;font-weight:bold;">{{ item.name }}</div>
                                    </div>
                                    <div><b style="font-family:Times New Roman;font-size:16px;font-weight:bold;">{{item.time}}</b></div>
                                </a-timeline-item>
                            </a-timeline>
                        </el-scrollbar>
                    </div>
                </MyCard>
            </el-col>

            <el-col :span="14">
                <MyCard header="团伙成员" class="tab-table">
                    <el-tabs type="border-card">
                        <!-- <el-tab-pane label="成员词云">
                            <WordCloud :pageRank="pageRank"  style="width:600px;height:300px;"/>
                        </el-tab-pane> -->
                        <el-tab-pane label="成员统计">
                            <NodeCountPie :nodeCount="nodeCount" style="height: 270px;"/>
                        </el-tab-pane>
                        <el-tab-pane label="组成网站">
                            <NodeTable :graphData="graphData"/>
                        </el-tab-pane>
                        <el-tab-pane label="组成公司">
    
                        </el-tab-pane>
                        <el-tab-pane label="组成人员">
    
                        </el-tab-pane>
                        <el-tab-pane label="IP">
    
                        </el-tab-pane>
                        <el-tab-pane label="下载链接">
    
                        </el-tab-pane>
                    </el-tabs>
                </MyCard>

                
            </el-col>
        </el-row>


        <el-row :gutter="2">
            <MyCard class="right-bottom" header="团伙成员重要性">
                <div class="card-body">
                    <el-col :span="15">
                        <NodePageRank :pageRank="pageRank"  style="height:340px;margin-top:30px"/>
                    </el-col>
                    
                    <el-col :span="9">
                        <div style="padding:20px">
                        <div style="color:rgb(218, 218, 218);margin-bottom:25px;">关键核心成员</div>
                        <div v-for="(item,index) in pageRank.slice(0,8)" style="margin-top:10px">
                            <el-row>
                                <el-col :span="2">
                                    <a-badge :count="index+1" :number-style="{ backgroundColor: 'purple',color: '#fff',boxShadow: '0 0 0 1px purple inset',}" style="margin-right:10px;"/>
                                </el-col>
                                <el-col :span="6">
                                    <el-tag round class="custom-button" type="primary" size="mini"
                                    v-bind:style="{ backgroundColor: item.color,borderColor:item.color }">{{item.label}}</el-tag>
                                </el-col>
                                <el-col :span="13">
                                    <span>{{ item.nodeName }} </span>
                                </el-col>
                                <el-col :span="3">
                                    <span style="display:inline-block;float:right">{{ item.pageRankValue.toFixed(3) }}</span>
                                </el-col>
                            </el-row>
                            <!-- <a-badge :count="index+1" :number-style="{ backgroundColor: 'purple',color: '#fff',boxShadow: '0 0 0 1px purple inset',}" style="margin-right:10px;"/>
                            <el-tag round class="custom-button" type="primary" size="mini"
                                v-bind:style="{ backgroundColor: item.color,borderColor:item.color }">{{item.label}}</el-tag>
                            <span>{{ item.nodeName }} </span>
                           <span style="display:inline-block;float:right">{{ item.pageRankValue.toFixed(3) }}</span> -->
                            </div>
                        </div>
                    </el-col>
                </div>
            </MyCard>
        </el-row>

    </div>
</template>
<!-- height:px -->
<script>
import MyCard from "./component/MyCard"
import NodeTable from "./component/NodeTable"
import NodePageRank from "./component/NodePageRank"
import GroupSankey from "./component/GroupSankey"
import GroupTable from "./component/GroupTable"
import FindPath from "./component/FindPath"
import GroupGraph from "./component/GroupGraph.vue"
import NodeCountPie from "./component/NodeCountPie.vue"
import GroupChord from "./component/GroupChord.vue"
import GroupCircle from "./component/GroupCircle.vue"
import MyPanelCard from "./component/MyPanelCard.vue"
import { Column } from '@antv/g2plot';
import { pageRank } from "@antv/algorithm";
import WordCloud from "./component/WordCloud.vue"

let pinyin = require('js-pinyin');
pinyin.setOptions({checkPolyphone: false, charCase: 0});

export default {
    data() {
        return {
            loading:true,
            graphData:'',
            nodeCount:[],
            cid:'',
            pageRank:'',
            subjectColors :[
                '#5F95FF', // blue
                '#61DDAA',
                '#65789B',
                '#F6BD16',
                '#7262FD',
                '#78D3F8',
                '#9661BC',
                '#F6903D',
                '#008685',
                '#F08BB4',
            ],
            timelineItems:[],
            labelType: {
                Website: "网站",
                Company: "公司",
                Person: "人员",
                Ip: "IP",
                Downlink: "下载链接",
            },
            pinyin: pinyin,
            labelCounts:[],
        }
    },
    components:{
        MyCard,
        NodeTable,
        NodePageRank,
        GroupSankey,
        GroupTable,
        FindPath,
        GroupGraph,
        NodeCountPie,
        GroupChord,
        GroupCircle,
        MyPanelCard,
        WordCloud,
    },
    methods: {
        getGroupData(cid){
            // var cid =3;
            // fetch('api/graph/domain?'+"dname="+"hongpig.com"+"&depth="+3) 
            fetch('api/graph/clusters/'+cid) 
            .then((res) => res.json())
            .then((data) => {
                // this.graphData = data;
                this.countNode(data)
                this.graphData = this.jsonData(data)
                this.loading=false;
                this.countGraphType();
                this.showPageRank(data)
                this.getTimeline(data.nodes)
            })
        },
        countNode(graphData){
            var nodeCount = {}
            graphData.nodes.forEach(node => {
                if(!(node.label in nodeCount)){
                    nodeCount[node.label] = 0; 
                }
                nodeCount[node.label] += 1; 
            });
            const result = Object.entries(nodeCount).map(([type, value]) => {
                return { type, value };
            });
            this.nodeCount = result;
            console.log(result);
        },
        countGraphType(){
            this.labelCounts = this.graphData.nodes.reduce((acc, obj) => {
                const label = obj.label;
                acc[label] = (acc[label] || 0) + 1;
                return acc;
            }, {});
            console.log(this.labelCounts);
        },
        jsonData(data) {
            const nodeIds = new Set(data.nodes.map(node => node.id));
            const parentIds = new Set(data.edges.map(edge => edge.source));
            const leafIds = new Set([...nodeIds].filter(id => !parentIds.has(id)));

            const result = {
                nodes: data.nodes.map(node => {
                if (leafIds.has(node.id)) {
                    return { ...node, isLeaf: true };
                } else {
                    return node;
                }
                }),
                edges: data.edges
            };
            console.log(result)
            return result
            // return JSON.stringify(result, null, 2);
        },
        showPageRank(graph){
            let rankResult = pageRank(graph); //return Object[id: pagerank] 
            const data = []
            for(var key in rankResult){
                if(key!=="c"){
                var nodeName;
                var nodeType;
                var label;
                graph.nodes.forEach(node => {
                    if(node["id"]==key){
                        nodeName = node.properties["name"] || "";
                        label = node.label;
                        if(node.label=="Person"){ 
                            nodeName = pinyin.getFullChars(node.properties["name"])
                        }else if(node.label=="Company"){
                            const length = node.properties["name"].length;
                            if(length==2 || length==3){
                                nodeName = pinyin.getFullChars(node.properties["name"])
                            }
                        }
                        
                        // nodeType = node.label;
                    }
                });
                data.push({
                    nodeId:key,
                    nodeName: nodeName,
                    pageRankValue: rankResult[key],
                    label:label,
                    color:"#7262FD",
                    // nodeType: nodeType,
                })}
            } 
            const result = data.sort((a, b) => b.pageRankValue - a.pageRankValue);
            console.log('pageRank的结果',result)
            this.pageRank=result;
        },
        getTimeline(data){
            data.forEach(node => { 
                var color = this.subjectColors[
                    Math.floor(Math.random() * this.subjectColors.length)
                ];
                if(node.label=="Website"){
                    if(node.properties["recorded_time"]==undefined||node.properties["recorded_time"]=="0000-00-00" || node.properties["recorded_time"]==null){
                        node.properties["recorded_time"]='';
                    }
                    this.timelineItems.push({
                        name:node.properties["name"],
                        time:node.properties["recorded_time"],
                        label:node.label,
                        color:color
                    })
                }else if(node.label=="Company"){
                    const length = node.properties["name"].length;
                    if(length==2 || length==3){
                        node.properties["name"] = pinyin.getFullChars(node.properties["name"])
                    }
                    this.timelineItems.push({
                        name:node.properties["name"],
                        time:node.properties["approval_date"],
                        label:node.label,
                        color:color
                    });
                }else if(node.label=="Person"){
                    this.timelineItems.push({
                        name: pinyin.getFullChars(node.properties["name"]),
                        time:'',
                        label:node.label,
                        color:color
                    });
                }else if(node.label=="Ip"){
                    this.timelineItems.push({
                        name:node.properties["name"],
                        time:'',
                        label:node.label,
                        color:color
                    });
                }
                // descend by time
                this.timelineItems.sort((a, b) => {
                    if(a.time=='' || b.time=='' || a.time=="0000-00-00" || b.time=="0000-00-00" || a.time==null || b.time==null || a.time==undefined || b.time==undefined){
                        return 0;
                    }
                    return new Date(b.time) - new Date(a.time);
                });
                console.log(this.timelineItems)
            });
        },
    },
    created(){
        this.cid = this.$route.query.id;
        this.getGroupData(this.cid)
    },
    // mounted(){
    //     this.getGroupData()
    // },
    computed: {
       
  }
}
</script>

<style lang="css" scoped>


    /deep/.el-row{
        margin-bottom: 2px;
    }
    /**.custom-button{
        color:black;font-size:13px;
    }**/
    .custom-button{
        color: #fff;font-size:12px;font-weight:400
    }
    .page-container{
        padding: 1px;
        margin-bottom:20px;
    }
    /*原本的高度是440，知识图谱*/
    .main-graph{
        height: 440px;
    }
    .find-path{
        height: 440px;
    }
    /*左侧*/
    .left-upper{
        height: 120px;
    }
    .left-middle{
        height: 320px;
    }
    /*右侧*/
    .right-upper{
        height: 440px;
    }
    /*底部高度*/
    .graph-bottom{
        height: 400px;
    }
    .right-bottom{
        height: 425px;
    }

   
    .timeline-card{
        height:430px;
    }

    .timeline-container{
        padding: 5px;
        height:430px;
    }
    .tab-table{
        height:430px;
    }

    .ant-timeline-item{
    color: #fff;
    }


    /deep/.el-card {
        border-radius: 4px;
        border: 1px solid transparent;
    }

    /deep/.el-tabs--border-card {
        background: #343A40;
        border: 1px solid transparent;
    }
    /deep/.el-tabs--border-card > .el-tabs__content {
        padding: 25px;
    }
    /deep/.el-tabs--border-card > .el-tabs__header .el-tabs__item.is-active {
        color: #00adff;
        background-color: #343940;
        border-right-color: #121820;
        border-left-color: #121820;
    }
    
</style>

<style scoped>
.info-box {
    float: left;
    box-shadow: 0 0 1px rgba(0,0,0,.125),0 1px 3px rgba(0,0,0,.2);
    border-radius: .25rem;
    display: -ms-flexbox;
    display: flex;
    margin-bottom: 1rem;
    min-height: 80px;
    padding: .5rem;
    position: relative;
    width: 180px;
    margin-right:20px;
}
.info-box .info-box-icon {
    /* border-radius: .25rem; */
    -ms-flex-align: center;
    align-items: center;
    display: -ms-flexbox;
    display: flex;
    font-size: 1.875rem;
    -ms-flex-pack: center;
    justify-content: center;
    text-align: center;
    width: 50px;
}

.info-box .info-box-content {
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
    flex-direction: column;
    -ms-flex-pack: center;
    justify-content: center;
    line-height: 1.8;
    -ms-flex: 1;
    flex: 1;
    padding: 0 10px;
    overflow: hidden;
}

.info-box .info-box-text, .info-box .progress-description {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.info-box .info-box-number {
    display: block;
    margin-top: .25rem;
    font-weight: 700;
}
</style>