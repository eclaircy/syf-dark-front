/* eslint-disable */
<template>
    <el-card>
        <div id='main'  :style="{height:height,width:width}" ></div>
        <!-- style="width:700px;height:500px;margin-left:20px;;margin-bottom:20px" -->
    </el-card>
    
</template>

<script>
import echarts from 'echarts';
require('echarts/lib/component/legend');
require('echarts/lib/chart/graph');
import resize from '../../../dashboard/admin/components/mixins/resize'

export default {
    mixins: [resize],
    props: {
        width: {
        type: String,
        default: '100%'
        },
        height: {
        type: String,
        default: '479.6px'
        },
        autoResize: {
        type: Boolean,
        default: true
        },
    },
    methods:{
        getGraphData(){
        this.axios({
            url:'https://06f6e7ea-4025-4c64-8f97-1d340bdc1dae.mock.pstmn.io/graph',
            // params:{"user":"syf"},
            method: 'get',
        }).then(res=>{
            console.log(res.data); //获取的数据
            this.graph_data = res.data;
            // this.graph_data = JSON.parse(JSON.stringify(res.data));
            console.log(this.graph_data);
            this.showGraphEcharts(this.graph_data);
        }).catch(err=>{
            console.log(err+"graph err");
        })
        },
        showGraphEcharts(graph){ //不知道怎么把数据传到这里来
            // var ROOT_PATH = 'https://echarts.apache.org/examples';
            var chartDom = document.getElementById('main');
            var myChart = echarts.init(chartDom);
            var option;
            myChart.showLoading();
            // $.getJSON(ROOT_PATH + '/data/asset/data/les-miserables.json', function (graph) {
            myChart.hideLoading();
            console.log(graph.type);
            graph.nodes.forEach(function (node) {
                node.label = {
                show: node.symbolSize > 30
                };
            });
            option = {
                title: {
                    text: 'Les Miserables',
                    subtext: 'Default layout',
                    top: 'bottom',
                    left: 'right'
                },
                tooltip: {},
                legend: [
                {
                    // selectedMode: 'single',
                    data: graph.categories.map(function (a) {
                    return a.name;
                    })
                }
                ],
                animation:true,
                animationDuration: 1000,
                animationEasingUpdate: 'quinticInOut',
                series: [
                {
                    name: 'Les Miserables',
                    type: 'graph',
                    // 图的布局。[ default: 'none' ]
                    layout: "force",
                    focusNodeAdjacency: true,
                    force: {repulsion: 1000,edgeLength: 160, layoutAnimation: false
                    },
                    // 'none' 不采用任何布局，使用节点中提供的 x， y 作为节点的位置。
                    // 'circular' 采用环形布局;'force' 采用力引导布局.
                    // layout: 'none',
                    data: graph.nodes,
                    links: graph.links,
                    categories: graph.categories,
                    color:['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc'],
                    gradientColor:{
                        0: "#f6efa6",
                        1: "#d88273",
                        2: "#bf444c"},
                    roam: true,
                    label: {
                    position: 'right',
                    formatter: '{b}'
                    },
                    lineStyle: {
                    color: 'source',
                    curveness: 0.3
                    },
                    emphasis: {
                    focus: 'adjacency',
                    lineStyle: {
                        width: 10
                    }
                    }
                }
                ]
            };
            myChart.setOption(option);
            option && myChart.setOption(option);
        //   }

        },
        showOverviewGraph(){
            var ROOT_PATH = 'https://echarts.apache.org/examples';
            var chartDom = document.getElementById('main');
            var myChart = echarts.init(chartDom);
            var option;
            myChart.showLoading();
            myChart.showLoading();
            $.get(ROOT_PATH + '/data/asset/data/webkit-dep.json', function (webkitDep) {
            myChart.hideLoading();
            option = {
                legend: {
                data: ['HTMLElement', 'WebGL', 'SVG', 'CSS', 'Other']
                },
                series: [
                {
                    type: 'graph',
                    layout: 'force',
                    animation: false,
                    label: {
                    position: 'right',
                    formatter: '{b}'
                    },
                    draggable: true,
                    data: webkitDep.nodes.map(function (node, idx) {
                    node.id = idx;
                    return node;
                    }),
                    categories: webkitDep.categories,
                    force: {
                    edgeLength: 5,
                    repulsion: 20,
                    gravity: 0.2
                    },
                    edges: webkitDep.links
                }
                ]
            };
            myChart.setOption(option);
            });

            option && myChart.setOption(option);
        },
        getDymGraphData(){
        this.axios({
            url:"https://06f6e7ea-4025-4c64-8f97-1d340bdc1dae.mock.pstmn.io/dym",
            method:"get"
        }).then(res=>{
            var chartDom = document.getElementById('main');
            var myChart = echarts.init(chartDom);
            var option;
            myChart.showLoading();
            myChart.showLoading();
            var webkitDep = res.data;
            myChart.hideLoading();
            option = {
                legend: {
                data: ['HTMLElement', 'WebGL', 'SVG', 'CSS', 'Other']
                },
                series: [
                {
                    type: 'graph',
                    layout: 'force',
                    animation: false,
                    color:['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc'],
                    label: {
                        position: 'right',
                        formatter: '{b}'
                    },
                    left: "center",
                    top: "center",
                    draggable: true,
                    data: webkitDep.nodes.map(function (node, idx) {
                        node.id = idx;
                        return node;
                    }),
                    backgroundColor:" rgba(0,0,0,0)",
                    categories: webkitDep.categories,
                    force: {
                    edgeLength: 5,
                    repulsion: 20,
                    gravity: 0.2
                    },
                    edges: webkitDep.links
                }
                ]
            };
            myChart.setOption(option);
            option && myChart.setOption(option);
        });
        },
    },
    mounted(){
        // this.getGraphData();
        this.getDymGraphData();
    }
}
</script>

<style>

</style>